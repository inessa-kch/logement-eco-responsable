{% extends "base.html" %}

{% block title %}Consommation{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', path='css/consommation.css') }}">
{% endblock %}

{% block content %}
<h1>Consommation</h1>

<!-- Logement Selection Buttons -->
<h2>Choisissez un Logement</h2>
<div class="logement-selection">
    {% for logement in logements %}
    <button class="logement-btn btn btn-outline-primary" data-logement-id="{{ logement.id_logement }}">
        {{ logement.adresse }}
    </button>
    {% endfor %}
</div>

<!-- Hidden elements to pass data to JavaScript -->
<div id="internetData" style="display:none;">{{ internet_data | tojson }}</div>
<div id="electriciteData" style="display:none;">{{ electricite_data | tojson }}</div>
<div id="eauData" style="display:none;">{{ eau_data | tojson }}</div>
<div id="chartData" style="display:none;">{{ chart_data | tojson }}</div>

<!-- Charts Section -->
<div class="charts-container mt-5" style="display:none;">
    <h2>Internet Consumption</h2>
    <canvas id="internetChart" width="450" height="250"></canvas>

    <h2>Electricity Consumption</h2>
    <canvas id="electricityChart" width="450" height="250"></canvas>

    <h2>Water Consumption</h2>
    <canvas id="waterChart" width="450" height="250"></canvas>

    <h2>Distribution of Factures</h2>
    <canvas id="facturePieChart" width="450" height="250"></canvas>
</div>

<!-- Ajouter Facture Form -->
<h2 class="mt-5">Ajouter Facture</h2>
<form id="factureForm">
    <div class="form-group">
        <label for="id_logement">Logement</label>
        <select class="form-control" id="id_logement" name="id_logement" required>
            <option value="" disabled selected>Select Logement</option>
            {% for logement in logements %}
                <option value="{{ logement.id_logement }}">{{ logement.adresse }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label for="type_facture">Type de Facture</label>
        <select class="form-control" id="type_facture" name="type_facture" required>
            <option value="Internet">Internet</option>
            <option value="Electricite">Electricité</option>
            <option value="Eau">Eau</option>
        </select>
    </div>

    <div class="form-group">
        <label for="date_facture">Date de Facture</label>
        <input type="date" class="form-control" id="date_facture" name="date_facture" required>
    </div>

    <div class="form-group">
        <label for="montant">Montant (€)</label>
        <input type="number" class="form-control" id="montant" name="montant" required>
    </div>

    <div class="form-group">
        <label for="valeur_consommation">Valeur de Consommation</label>
        <input type="number" class="form-control" id="valeur_consommation" name="valeur_consommation" required>
    </div>

    <div class="form-group">
        <label for="unite_consommation">Unité</label>
        <input type="text" class="form-control" id="unite_consommation" name="unite_consommation" required>
    </div>

    <button type="submit" class="btn btn-primary">Ajouter Facture</button>
</form>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', path='js/consommation.js') }}"></script>
{% endblock %}
